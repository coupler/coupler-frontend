<app-client-error *ngIf="clientError" [error]="clientError">
</app-client-error>
<ng-template [ngIf]="job">
  <h2>Job #{{job.id}}</h2>

  <ng-template [ngIf]="job.kind === 'linkage' && linkage">
    <h3>Linkage</h3>
    <app-linkages-list [linkages]="[linkage]">
    </app-linkages-list>
  </ng-template>

  <ng-template [ngIf]="job.kind === 'migration' && migration">
    <h3>Migration</h3>
    <app-migrations-list [migrations]="[migration]">
    </app-migrations-list>
  </ng-template>

  <p class="mt-3">
    <strong>Status:</strong> {{job.status}}
    <i *ngIf="!job.isStopped()" class="fa fa-cog fa-spin" style="font-size: larger"></i>
  </p>
  <p>
    <strong>Started at:</strong>
    <ng-template [ngIf]="job.startedAt" [ngIfElse]="jobNotStarted">
      {{job.startedAt | date:"short"}}
    </ng-template>
    <ng-template #jobNotStarted>
      Not yet started
    </ng-template>
  </p>
  <p *ngIf="job.endedAt">
    <strong>Ended at:</strong> {{job.endedAt | date:"short"}}
  </p>
  <p *ngIf="job.error">
    <strong>Error:</strong> {{job.error}}
  </p>

  <div *ngIf="job.linkageResult && job.status == 'finished'" class="results">
    <h3>Results</h3>
    <p>
      <strong>Number of matches:</strong>
      {{job.linkageResult.matchCount}}
    </p>

    <app-linkage-result-detail *ngIf="job.linkageResult.matchCount > 0"
      [linkageResult]="job.linkageResult"
      [linkage]="linkage">
    </app-linkage-result-detail>
  </div>

  <button type="button" class="btn btn-secondary mt-2" (click)="goBack()">
    <i class="fa fa-chevron-left"></i> Back
  </button>
</ng-template>
